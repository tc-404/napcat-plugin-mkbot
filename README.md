# MKbot v2 插件

一个功能不多的 NapCat QQ 机器人插件，提供授权系统、群管功能、娱乐系统、运行状态监控等多个模块。

## 📋 功能总览

### 🔐 授权系统
- **卡密生成** - 支持生成天卡、周卡、月卡、半年卡、年卡、永久卡
  - 单次生成：`生成天卡授权`、`生成周卡授权` 等
  - 批量生成：`生成天卡授权[数量]`（支持 1-100 张）
  
- **卡密使用** - 用户通过卡密激活授权
  - 指令：`使用卡密[卡密]`
  - 支持群聊和私聊两种方式
  
- **授权管理** - 查看和管理授权信息
  - 查询授权：`授权判断`、`授权判断[群号]`
  - 添加授权：`添加天卡授权`、`添加天卡授权[群号]`
  - 删除授权：`删除授权`、`删除授权[群号]`
  - 卡密列表：`卡密列表`
  - 删除卡密：`删除卡密[卡密]`、`清空全部`

- **授权查询** - 实时查看授权状态
  - 显示授权时间、剩余时长、到期时间
  - 支持跨群查询

---

### 👥 群管功能

#### 基础群管
- **禁言通知** - 群成员被禁言时发送通知
- **入群审核** - 新成员入群时进行审核
- **邀人统计** - 统计群成员邀请人数
- **自助头衔** - 成员可自助设置群头衔
- **伪造聊天** - 伪造聊天消息（需授权）
- **黑白名单** - 支持黑名单和白名单管理
- **退群拉黑** - 成员退群时自动拉黑
- **退群通知** - 成员退群时发送通知

#### 高级群管
- **整点报时** - 每个整点自动报时
- **禁发红包** - 禁止群成员发送红包
- **入群图片** - 新成员入群时发送欢迎图片
- **违禁检测** - 检测违禁词汇并处理
- **全群打卡** - 支持全群打卡功能
- **自动回赞** - 自动回赞群成员

#### 群管菜单
- 指令：`群管系统`、`群管功能`、`群管菜单`
- 显示所有群管功能列表和使用说明

---

### 🎮 娱乐系统

#### 基础娱乐
- **菜单** - 显示所有娱乐功能
- **今日运势** - 查看今日运势
- **音乐系统** - 音乐播放和收藏
- **漂流瓶** - 发送和接收漂流瓶消息
- **头街系统** - 头街排行榜

#### 高级娱乐
- **全员头衔** - 查看全员头衔
- **归笺排行榜** - 显示归笺排行
- **音乐收藏** - 收藏喜欢的音乐

---

### 📊 系统监控

#### 运行状态
- **CPU 使用率** - 实时 CPU 使用百分比
- **内存使用** - 总内存、已用、空闲内存
- **磁盘空间** - 磁盘总容量、已用、空闲空间
- **系统信息** - 系统类型、架构、主机名等
- **进程列表** - 显示内存占用最高的 20 个进程
- **运行时间** - 系统运行时间和进程运行时间

#### 查询指令
- `运行状态` - 查看完整的系统运行状态
- 支持跨平台（Windows、Linux、macOS）

---

### 🛠️ 工具函数库

#### 文件操作
- `readA(filename)` - 读取文本文件
- `readB(filename, key, defaultValue)` - 读取 JSON 文件中的键值
- `writeA(filename, content)` - 写入文本文件
- `writeB(filename, key, value)` - 写入 JSON 文件键值
- `deleteKey(filename, key)` - 删除 JSON 文件中的键
- `hasKey(filename, key)` - 检查键是否存在
- `getKeys(filename)` - 获取 JSON 文件中的所有键
- `clear(filename)` - 清空文件内容

#### 时间处理
- `timeA(format, timestamp)` - 格式化时间戳为日期字符串
  - 格式：`y-m-d H:i:s`（年-月-日 时:分:秒）
- `timeB(format, timestamp)` - 将秒数转换为时间差字符串
  - 格式：`d天H时i分s秒`（天时分秒）

#### 随机数生成
- `rand(min, max)` - 生成指定范围的随机数
  - 支持数字范围：`rand(1, 100)`
  - 支持字符范围：`rand('a', 'z')`

#### 货币转换
- `moneyA(number)` - 将数字转换为游戏货币格式
  - 单位：玉令（100000）、玉笺（1000）、归笺（1）
  - 示例：`moneyA(123456)` → `1玉令23玉笺456归笺`

#### 系统信息
- `getSystemInfo()` - 获取完整的系统信息对象
- `getProcessList()` - 获取进程列表（按内存排序）
- `formatBytes(bytes)` - 格式化字节为可读格式（B/KB/MB/GB/TB）

#### 网络操作
- `downloadFile(url, savePath)` - 下载文件到本地
- `puppeteer(html, data)` - 调用 Puppeteer 插件进行网页截图

#### 消息处理
- `sendReply(event, content, ctx)` - 发送回复消息
- `sendForward(event, messages, ctx)` - 发送合并转发消息
- `giveAT(message)` - 提取消息中的 @用户 列表
- `giveImages(message)` - 提取消息中的图片 URL 列表
- `giveText(message)` - 提取消息中的文本内容
- `BOTAPI(ctx, action, params)` - 调用 NapCat API

---

### ⚙️ 配置系统

#### 基础配置
- **主人 QQ** - 设置插件主人（支持多个）
- **非主人回复** - 非主人消息是否触发回复
- **非主人回复内容** - 自定义回复内容
- **测试功能** - 启用/禁用测试功能（需 Puppeteer 插件）

#### 开关管理
- **群聊开关** - 管理插件在各个群的启用状态
- **好友开关** - 管理插件对各个好友的启用状态
- **事件开关** - 控制各个事件功能的启用/禁用

#### WebUI 配置面板
- 基础设置页面 - 配置主人 QQ、回复内容等
- 群聊开关页面 - 管理群聊启用状态
- 好友开关页面 - 管理好友启用状态
- 更新公告页面 - 查看插件更新公告

---

### 📱 WebUI 功能

#### 仪表板
- 实时显示插件状态
- 快速访问各个功能模块

#### 基础设置
- 主人 QQ 配置
- 非主人回复开关和内容
- 测试功能开关
- 神秘数字设置（长按调试按钮 5 秒打开）

#### 开关管理
- 群聊开关 - 网格视图显示所有群聊
- 好友开关 - 网格视图显示所有好友
- 支持搜索和批量操作

#### 更新公告
- 显示插件版本更新信息
- 支持下载按钮（需密钥验证）
- 区分正式版和测试版

---

### 🔧 主人权限指令

#### 系统管理
- `重启服务` - 重启插件服务
- `运行状态` - 查看系统运行状态
- `菜单` - 显示完整功能菜单

#### 事件管理
- `开启[事件名]` - 启用指定事件
- `关闭[事件名]` - 禁用指定事件
- `开启全部事件` - 启用所有事件
- `关闭全部事件` - 禁用所有事件

#### 支持的事件
- 禁言通知、入群审核、邀人统计、自助头衔
- 伪造聊天、黑白名单、退群拉黑、退群通知
- 整点报时、禁发红包、入群图片、违禁检测
- 全群打卡、自动回赞

---

## 🚀 快速开始

### 安装
1. 直接压缩包(zip)导入
2. 在 WebUI 中配置主人 QQ

### 基础使用
1. 在群聊中发送 `菜单` 查看所有功能
2. 发送 `授权系统` 了解授权相关指令
3. 发送 `群管系统` 了解群管功能

### 配置授权
1. 主人发送 `生成天卡授权` 生成卡密
2. 用户发送 `使用卡密[卡密]` 激活授权
3. 发送 `授权判断` 查看授权状态

---

## 📝 指令速查表

| 功能 | 指令 | 权限 |
|------|------|------|
| 查看菜单 | `菜单` | 所有人 |
| 授权系统 | `授权系统` | 所有人 |
| 群管系统 | `群管系统` | 所有人 |
| 查询授权 | `授权判断` | 所有人 |
| 使用卡密 | `使用卡密[卡密]` | 所有人 |
| 生成卡密 | `生成天卡授权` | 主人 |
| 添加授权 | `添加天卡授权` | 主人 |
| 删除授权 | `删除授权` | 主人 |
| 运行状态 | `运行状态` | 主人 |
| 重启服务 | `重启服务` | 主人 |
| 事件开关 | `开启/关闭[事件名]` | 主人 |

---

## 🎯 功能分类

### 按用户类型
- **普通用户** - 菜单、娱乐、查询授权、使用卡密
- **群管理员** - 群管功能、事件管理
- **主人** - 所有功能、授权管理、系统管理

### 按功能模块
- **授权系统** - 卡密生成、使用、管理
- **群管功能** - 禁言、审核、黑名单等
- **娱乐系统** - 运势、音乐、漂流瓶等
- **系统监控** - CPU、内存、磁盘、进程
- **工具函数** - 文件、时间、随机、网络等

### 按触发方式
- **指令触发** - 用户主动发送指令
- **事件触发** - 群事件自动触发（禁言、入群等）
- **定时触发** - 整点报时等定时任务

---

## 🔒 安全特性

- **授权验证** - 所有功能都支持授权检查
- **主人权限** - 敏感操作仅主人可执行
- **黑白名单** - 支持用户和群的黑白名单
- **事件开关** - 可灵活控制各个事件的启用状态
- **密钥验证** - 公告下载支持密钥验证

---

## 📦 依赖

- Node.js 18+
- NapCat 4.17.15+
- Puppeteer 插件（可选，用于网页截图）

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

## 📄 许可证

MIT License

---

**最后更新：2026-02-19**